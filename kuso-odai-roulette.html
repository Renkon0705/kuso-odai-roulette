<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„ÇØ„ÇΩ„ÅäÈ°å„É´„Éº„É¨„ÉÉ„Éà</title>

<style>
body {
  background: radial-gradient(circle at top, #222, #000);
  font-family: system-ui, sans-serif;
  color: #fff;
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  width: 90%;
  max-width: 900px;
  background: #000;
  border: 4px solid #c9a24d;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 0 30px rgba(201,162,77,.6);
  text-align: center;
}

h1 {
  color: #c9a24d;
  margin-bottom: 25px;
}

.slots {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.slot {
  flex: 1;
  height: 140px;
  overflow: hidden;
  background: #111;
  border: 2px solid #555;
  border-radius: 12px;
  position: relative;
}

.reel {
  position: absolute;
  width: 100%;
  top: 0;
}

.item {
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  padding: 10px;
  box-sizing: border-box;
}

.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

button {
  flex: 1;
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
  border: 2px solid #fff;
  background: transparent;
  color: #fff;
  cursor: pointer;
}

button:disabled {
  opacity: 0.4;
}

#spinBtn {
  border-color: #c9a24d;
  color: #c9a24d;
}
</style>
</head>

<body>
<div class="container">
  <h1>üé∞ „ÇØ„ÇΩ„ÅäÈ°å„É´„Éº„É¨„ÉÉ„Éà</h1>

  <div class="slots">
    <div class="slot"><div class="reel" id="reel0"></div></div>
    <div class="slot"><div class="reel" id="reel1"></div></div>
    <div class="slot"><div class="reel" id="reel2"></div></div>
  </div>

  <div class="controls">
    <button onclick="stopReel(0)">STOP</button>
    <button onclick="stopReel(1)">STOP</button>
    <button onclick="stopReel(2)">STOP</button>
  </div>

  <button id="spinBtn" onclick="startSpin()">Âõû„Åô</button>
</div>

<script>
const csvURL =
"https://docs.google.com/spreadsheets/d/1l2aSZI_c9Ae9O4bBD8U1YBt0JiAbg75ahg1AAhaSqqU/export?format=csv&gid=1966770932";

const ITEM_HEIGHT = 140;

let lists = [[], [], []];
let reels = [];
let timers = [];
let spinning = [false, false, false];

// CSVË™≠„ÅøËæº„Åø
fetch(csvURL)
  .then(res => res.text())
  .then(text => {
    const rows = text.trim().split("\n").slice(1);
    rows.forEach(r => {
      const c = r.split(",");
      if (c[1]) lists[0].push(c[1]);
      if (c[2]) lists[1].push(c[2]);
      if (c[3]) lists[2].push(c[3]);
    });

    for (let i = 0; i < 3; i++) {
      reels[i] = document.getElementById("reel" + i);
      buildReel(i);
    }
  });

// „É™„Éº„É´ÊßãÁØâ
function buildReel(i) {
  reels[i].innerHTML = "";
  lists[i].forEach(t => {
    const d = document.createElement("div");
    d.className = "item";
    d.textContent = t;
    reels[i].appendChild(d);
  });
}

// ÂõûËª¢ÈñãÂßã
function startSpin() {
  for (let i = 0; i < 3; i++) {
    clearInterval(timers[i]);
    reels[i].style.transform = "translateY(0px)";
    spinning[i] = true;

    timers[i] = setInterval(() => {
      reels[i].dataset.pos = ((+reels[i].dataset.pos || 0) + 20);
      reels[i].style.transform =
        `translateY(${-reels[i].dataset.pos}px)`;
    }, 16);
  }
}

// „Çπ„Éà„ÉÉ„ÉóÔºàÂÆåÂÖ®ÂÆâÂÖ®ÁâàÔºâ
function stopReel(i) {
  if (!spinning[i]) return;
  spinning[i] = false;
  clearInterval(timers[i]);

  const maxIndex = lists[i].length - 1;
  const index = Math.floor(Math.random() * (maxIndex + 1));

  reels[i].style.transition = "transform 0.25s ease-out";
  reels[i].style.transform =
    `translateY(${-index * ITEM_HEIGHT}px)`;

  setTimeout(() => {
    reels[i].style.transition = "none";
  }, 300);
}
</script>
</body>
</html>
