<script>
const SHEET_ID = "1l2aSZI_c9Ae9O4bBD8U1YBt0JiAbg75ahg1AAhaSqqU";
const GID = "1966770932";
const CSV_URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

let listB = [];
let listC = [];
let listD = [];

function parseCSV(text) {
  return text
    .trim()
    .split("\n")
    .slice(1) // 2行目から
    .map(row => row.split(","));
}

fetch(CSV_URL)
  .then(res => {
    if (!res.ok) throw new Error("CSV fetch failed");
    return res.text();
  })
  .then(text => {
    const rows = parseCSV(text);
    listB = rows.map(r => r[1]).filter(Boolean);
    listC = rows.map(r => r[2]).filter(Boolean);
    listD = rows.map(r => r[3]).filter(Boolean);
    console.log("読み込み成功", listB.length, listC.length, listD.length);
  })
  .catch(err => {
    console.error("CSV読み込み失敗", err);
  });

document.getElementById("spinButton").addEventListener("click", () => {
  if (!listB.length || !listC.length || !listD.length) {
    alert("お題データを読み込み中です");
    return;
  }

  const b = listB[Math.floor(Math.random() * listB.length)];
  const c = listC[Math.floor(Math.random() * listC.length)];
  const d = listD[Math.floor(Math.random() * listD.length)];

  document.getElementById("result").textContent =
    `${b} ${c} ${d}`;
});
</script>
