<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¯ã‚½ãŠé¡Œãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ ver1.1.2</title>

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: system-ui, sans-serif;
  text-align: center;
}

.slots {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 40px;
}

.slot {
  width: 140px;
  height: 60px;
  overflow: hidden;
  border: 2px solid #fff;
  font-size: 22px;
  line-height: 60px;
  background: #000;
}

.slot-inner {
  position: relative;
  top: 0;
}

.buttons {
  margin-top: 20px;
}

button {
  font-size: 18px;
  padding: 10px 20px;
  margin: 5px;
  cursor: pointer;
}

/* ===== å®ŒæˆãŠé¡Œ ===== */
#resultOverlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  z-index: 999;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

#resultText {
  font-size: 42px;
  font-weight: bold;
  display: flex;
  gap: 20px;
}

/* Ã—ãƒœã‚¿ãƒ³ï¼šå®ŒæˆãŠé¡Œã®ä¸‹ */
#closeBtn {
  margin-top: 30px;
  font-size: 24px;
  padding: 12px 36px;
}

footer {
  position: fixed;
  bottom: 5px;
  width: 100%;
  font-size: 12px;
  color: #888;
}
</style>
</head>

<body>

<h1>ğŸ° ã‚¯ã‚½ãŠé¡Œãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>

<div class="slots">
  <div class="slot"><div class="slot-inner" id="slot1"></div></div>
  <div class="slot"><div class="slot-inner" id="slot2"></div></div>
  <div class="slot"><div class="slot-inner" id="slot3"></div></div>
</div>

<div class="buttons">
  <button onclick="startAll()">å›ã™</button>
  <button onclick="stopSlot(0)">æ­¢ã‚â‘ </button>
  <button onclick="stopSlot(1)">æ­¢ã‚â‘¡</button>
  <button onclick="stopSlot(2)">æ­¢ã‚â‘¢</button>
</div>

<div id="resultOverlay">
  <div id="resultText"></div>
  <button id="closeBtn" onclick="closeResult()">Ã—</button>
</div>

<footer>ver 1.1.2</footer>

<script>
const SHEET_ID = "1l2aSZI_c9Ae9O4bBD8U1YBt0JiAbg75ahg1AAhaSqqU";
const GID = "1966770932";
const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${GID}`;

let data = [[], [], []];
let timers = [];
let running = [false, false, false];
let current = ["", "", ""];

fetch(URL)
  .then(r => r.text())
  .then(text => {
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;
    rows.slice(1).forEach(r => {
      if (r.c[1]) data[0].push(r.c[1].v);
      if (r.c[2]) data[1].push(r.c[2].v);
      if (r.c[3]) data[2].push(r.c[3].v);
    });
    initSlots();
  });

function initSlots() {
  for (let i = 0; i < 3; i++) {
    document.getElementById(`slot${i+1}`).innerHTML =
      data[i].map(t => `<div>${t}</div>`).join("");
  }
}

function startAll() {
  closeResult();
  for (let i = 0; i < 3; i++) startSlot(i);
}

function startSlot(i) {
  if (running[i]) return;
  running[i] = true;
  const inner = document.getElementById(`slot${i+1}`);
  let pos = 0;
  const height = 60 * data[i].length;

  timers[i] = setInterval(() => {
    pos += 20;
    if (pos >= height) pos = 0;
    inner.style.top = -pos + "px";
  }, 30);
}

function stopSlot(i) {
  if (!running[i]) return;
  running[i] = false;
  clearInterval(timers[i]);

  const index = Math.floor(Math.random() * data[i].length);
  current[i] = data[i][index];
  document.getElementById(`slot${i+1}`).style.top = -(index * 60) + "px";

  if (running.every(v => !v)) showResult();
}

function showResult() {
  document.getElementById("resultText").innerHTML =
    `<div>${current[0]}</div><div>${current[1]}</div><div>${current[2]}</div>`;
  document.getElementById("resultOverlay").style.display = "flex";
}

function closeResult() {
  document.getElementById("resultOverlay").style.display = "none";
}
</script>

</body>
</html>
