<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¯ã‚½ãŠé¡Œãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>

<style>
body {
  background: radial-gradient(circle at top, #222, #000);
  font-family: system-ui, sans-serif;
  color: #fff;
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  width: 90%;
  max-width: 900px;
  background: #000;
  border: 4px solid #c9a24d;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 0 30px rgba(201,162,77,.6);
  text-align: center;
  position: relative;
}

h1 {
  color: #c9a24d;
  margin-bottom: 25px;
}

.slots {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.slot {
  flex: 1;
  height: 140px;
  overflow: hidden;
  background: #111;
  border: 2px solid #555;
  border-radius: 12px;
  position: relative;
}

.reel {
  position: absolute;
  width: 100%;
  top: 0;
}

.item {
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  padding: 10px;
  box-sizing: border-box;
}

.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

button {
  flex: 1;
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
  border: 2px solid #fff;
  background: transparent;
  color: #fff;
  cursor: pointer;
}

#spinBtn {
  border-color: #c9a24d;
  color: #c9a24d;
}

#version {
  position: absolute;
  right: 16px;
  bottom: 10px;
  font-size: 12px;
  opacity: 0.6;
}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ° ã‚¯ã‚½ãŠé¡Œãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>

  <div class="slots">
    <div class="slot"><div class="reel" id="reel0"></div></div>
    <div class="slot"><div class="reel" id="reel1"></div></div>
    <div class="slot"><div class="reel" id="reel2"></div></div>
  </div>

  <div class="controls">
    <button onclick="stopReel(0)">STOP</button>
    <button onclick="stopReel(1)">STOP</button>
    <button onclick="stopReel(2)">STOP</button>
  </div>

  <button id="spinBtn" onclick="startSpin()">å›ã™</button>

  <div id="version">ver. 1.1.1</div>
</div>

<script>
const csvURL =
"https://docs.google.com/spreadsheets/d/1l2aSZI_c9Ae9O4bBD8U1YBt0JiAbg75ahg1AAhaSqqU/export?format=csv&gid=1966770932";

const ITEM_HEIGHT = 140;
const LOOP_COUNT = 3;
const SPEED = 14;

let lists = [[], [], []];
let reels = [];
let timers = [];
let positions = [0, 0, 0];
let spinning = [false, false, false];

fetch(csvURL)
  .then(res => res.text())
  .then(text => {
    const rows = text.trim().split("\n").slice(1);
    rows.forEach(r => {
      const c = r.split(",");
      if (c[1]) lists[0].push(c[1]);
      if (c[2]) lists[1].push(c[2]);
      if (c[3]) lists[2].push(c[3]);
    });

    for (let i = 0; i < 3; i++) {
      reels[i] = document.getElementById("reel" + i);
      buildReel(i);
    }
  });

// ãƒªãƒ¼ãƒ«æ§‹ç¯‰ï¼ˆè¤‡è£½ï¼‰
function buildReel(i) {
  reels[i].innerHTML = "";
  for (let l = 0; l < LOOP_COUNT; l++) {
    lists[i].forEach(t => {
      const d = document.createElement("div");
      d.className = "item";
      d.textContent = t;
      reels[i].appendChild(d);
    });
  }
}

// â–¶ å›è»¢é–‹å§‹ï¼ˆä¸‹æ–¹å‘ãƒ»æ­£ãƒ«ãƒ¼ãƒ—ï¼‰
function startSpin() {
  for (let i = 0; i < 3; i++) {
    clearInterval(timers[i]);
    reels[i].style.transition = "none";

    const limit = lists[i].length * ITEM_HEIGHT;
    positions[i] = -limit; // â† ä¸‹æ–¹å‘ç”¨ã®åˆæœŸä½ç½®
    spinning[i] = true;

    timers[i] = setInterval(() => {
      positions[i] += SPEED;

      if (positions[i] >= 0) {
        positions[i] = -limit;
      }

      reels[i].style.transform =
        `translateY(${positions[i]}px)`;
    }, 16);
  }
}

// â–  ã‚¹ãƒˆãƒƒãƒ—
function stopReel(i) {
  if (!spinning[i]) return;
  spinning[i] = false;
  clearInterval(timers[i]);

  const index = Math.floor(Math.random() * lists[i].length);
  const target = -index * ITEM_HEIGHT;

  reels[i].style.transition = "transform 0.3s ease-out";
  reels[i].style.transform = `translateY(${target}px)`;

  positions[i] = target;

  setTimeout(() => {
    reels[i].style.transition = "none";
  }, 350);
}
</script>
</body>
</html>
